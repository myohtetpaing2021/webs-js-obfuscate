<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ကိုယ်ပိုင်ဘဏ္ဍာရေး | Personal Finance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Padauk font ကို အဓိကထား အသုံးပြုထားပါတယ် */
        body {
            font-family: 'Padauk', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            background-image: radial-gradient(circle at 50% 0, rgba(14, 116, 144, 0.2), rgba(15, 23, 42, 0) 25%);
            color: #e2e8f0; /* Slate 200 */
        }
        /* ငွေဝင်ငွေထွက်စာရင်းတွေကို ဘယ်ဘက်မှာ အရောင်ဘားနဲ့ ခွဲခြားပြသထားပါတယ် */
        .transaction-item.plus { border-left: 5px solid #22c55e; /* Green 500 */ }
        .transaction-item.minus { border-left: 5px solid #ef4444; /* Red 500 */ }
        .transaction-item.saving { border-left: 5px solid #3b82f6; /* Blue 500 */ }

        /* တိုးတက်မှုပြဘား (Progress Bar) ပုံစံ */
        .progress-bar-container { background-color: #334155; border-radius: 9999px; overflow: hidden; height: 10px; }
        .progress-bar { height: 100%; transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out; border-radius: 9999px; }

        /* Modal (Pop-up) ပုံစံ */
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }

        /* အဓိက panel တွေရဲ့ ပုံစံ */
        .panel {
            background-color: rgba(30, 41, 59, 0.7); /* Slate 800 with 70% opacity */
            backdrop-filter: blur(8px);
            border-radius: 0.75rem; /* 12px */
            border: 1px solid rgba(56, 189, 248, 0.2); /* Cyan 400 with 20% opacity */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        
        /* Dashboard ကတ်ပြားတွေရဲ့ ပုံစံ */
        .dashboard-card { transition: transform 0.2s, box-shadow 0.2s; }
        .dashboard-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1); }
        
        /* Loading Spinner ပုံစံ */
        #loader { border-top-color: #3b82f6; -webkit-animation: spin 1s linear infinite; animation: spin 1s linear infinite; }
        @-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Custom scrollbar ပုံစံ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-900 flex justify-center items-start min-h-screen p-4 sm:p-6 lg:p-8">
    
    <!-- Loading Spinner -->
    <div id="loading-overlay" class="fixed inset-0 bg-slate-900 bg-opacity-90 flex justify-center items-center z-50 transition-opacity duration-300">
        <div id="loader" class="w-16 h-16 border-8 border-slate-700 rounded-full"></div>
    </div>


    <div id="app-content" class="w-full max-w-7xl mx-auto opacity-0 transition-opacity duration-500">
        <!-- Header Section -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
            <div class="flex items-center self-start sm:self-center">
                <div class="bg-cyan-500/10 p-2 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-slate-100">ကိုယ်ပိုင်ဘဏ္ဍာရေး</h1>
            </div>

            <div class="w-full sm:w-auto flex flex-col sm:flex-row items-center gap-2">
                <div class="flex items-center gap-2 w-full">
                    <select id="year-filter" class="w-full sm:w-auto bg-slate-700 border border-slate-600 text-slate-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm"></select>
                    <select id="month-filter" class="w-full sm:w-auto bg-slate-700 border border-slate-600 text-slate-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-sm"></select>
                </div>
                 <div class="relative">
                    <button id="menu-btn" class="p-2 rounded-full hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-slate-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                        </svg>
                    </button>
                    <div id="menu-dropdown" class="absolute right-0 mt-2 w-56 bg-slate-800 rounded-lg shadow-xl z-20 hidden origin-top-right ring-1 ring-black ring-opacity-5 focus:outline-none border border-slate-700" role="menu" aria-orientation="vertical" aria-labelledby="menu-btn">
                        <div class="py-1" role="none">
                            <p class="px-4 pt-2 pb-1 text-xs text-slate-500 uppercase">ဒေတာ စီမံခန့်ခွဲမှု</p>
                            <button id="export-data-btn" class="w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 transition-colors" role="menuitem">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                                <span>Export Data (.json)</span>
                            </button>
                            <button id="import-data-btn" class="w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 transition-colors" role="menuitem">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 13.293a1 1 0 011.414 0L9 14.586V7a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                <span>Import Data (.json)</span>
                            </button>
                            <div class="border-t border-slate-700 my-1"></div>
                            <button id="delete-all-btn" class="w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-red-400 hover:bg-red-500/20 hover:text-red-300 transition-colors" role="menuitem">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                                <span>Delete All Data</span>
                            </button>
                             <input type="file" id="import-file-input" class="hidden" accept="application/json">
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <!-- ကတ်ပြားများကို အရောင်များဖြင့် ခွဲခြားပြသထားပါသည် -->
            <div class="dashboard-card panel p-4 border-t-4 border-green-500">
                <div class="flex items-center text-slate-400 text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>စုစုပေါင်းဝင်ငွေ</div>
                <p id="card-income" class="text-2xl font-bold text-slate-100 mt-2">+0.00 ကျပ်</p>
            </div>
            <div class="dashboard-card panel p-4 border-t-4 border-red-500">
                <div class="flex items-center text-slate-400 text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" /></svg>စုစုပေါင်းထွက်ငွေ</div>
                <p id="card-expense" class="text-2xl font-bold text-slate-100 mt-2">-0.00 ကျပ်</p>
            </div>
            <div class="dashboard-card panel p-4 border-t-4 border-blue-500">
                <div class="flex items-center text-slate-400 text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>စုစုပေါင်းစုငွေ</div>
                <p id="card-savings" class="text-2xl font-bold text-slate-100 mt-2">0.00 ကျပ်</p>
            </div>
            <div class="dashboard-card panel p-4 border-t-4 border-purple-500">
                <div class="flex items-center text-slate-400 text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>လက်ကျန်ငွေ</div>
                <p id="card-balance" class="text-2xl font-bold text-slate-100 mt-2">0.00 ကျပ်</p>
            </div>
            <div class="dashboard-card panel p-4 border-t-4 border-orange-500">
                <div class="flex items-center text-slate-400 text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>ဘတ်ဂျက်ကျန်ငွေ</div>
                <p id="card-budget-remaining" class="text-2xl font-bold text-slate-100 mt-2">0.00 ကျပ်</p>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Actions & Transactions -->
            <div class="lg:col-span-2 flex flex-col gap-6">
                 <!-- Quick Actions -->
                 <div class="panel p-6">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">အမြန်လုပ်ဆောင်ရန်</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <button id="open-add-modal-btn" class="bg-cyan-500 text-slate-900 font-bold py-3 px-4 rounded-lg hover:bg-cyan-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 transition-transform transform hover:scale-105 flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                            <span>စာရင်းသစ်ထည့်မည်</span>
                        </button>
                         <button id="set-budget-btn" class="bg-slate-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 focus:ring-offset-slate-800 transition-transform transform hover:scale-105 flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" /></svg>
                            <span>လစဉ်ဘတ်ဂျက်</span>
                        </button>
                        <button id="open-add-goal-btn" class="bg-slate-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 focus:ring-offset-slate-800 transition-transform transform hover:scale-105 flex items-center justify-center gap-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                            <span>စုငွေပန်းတိုင်</span>
                        </button>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="panel p-6">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4">
                         <h3 class="text-lg font-bold text-slate-200 mb-3 sm:mb-0">မှတ်တမ်းများ</h3>
                         <div id="transaction-filter-buttons" class="flex items-center bg-slate-800 rounded-lg p-1">
                            <button data-filter="all" class="transaction-filter-btn px-3 py-1 text-sm font-semibold rounded-md bg-cyan-600 text-white">အားလုံး</button>
                            <button data-filter="income" class="transaction-filter-btn px-3 py-1 text-sm font-semibold rounded-md text-slate-400 hover:bg-slate-700 hover:text-slate-200 transition-colors">ဝင်ငွေ</button>
                            <button data-filter="expense" class="transaction-filter-btn px-3 py-1 text-sm font-semibold rounded-md text-slate-400 hover:bg-slate-700 hover:text-slate-200 transition-colors">ထွက်ငွေ</button>
                            <button data-filter="saving" class="transaction-filter-btn px-3 py-1 text-sm font-semibold rounded-md text-slate-400 hover:bg-slate-700 hover:text-slate-200 transition-colors">စုငွေ</button>
                        </div>
                    </div>
                    <ul id="list" class="list-none m-0 p-0 mt-4 space-y-3 max-h-96 overflow-y-auto">
                        <!-- စာရင်းများ ဒီမှာပေါ်လာပါမည် -->
                    </ul>
                </div>
            </div>
            
            <!-- Right Column: Analysis & Goals -->
            <div class="lg:col-span-1 flex flex-col gap-6">
                <!-- Budget Tracker -->
                <div class="panel p-6">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">ဘတ်ဂျက်သုံးစွဲမှု</h3>
                     <form id="budget-form" class="hidden flex items-center gap-2 mb-4">
                         <input type="text" inputmode="decimal" id="budget-input" placeholder="ဘတ်ဂျက် သတ်မှတ်ပါ" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"/>
                         <button type="submit" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition">သတ်မှတ်မည်</button>
                     </form>
                     <div id="budget-display">
                         <div class="progress-bar-container mb-2">
                             <div id="budget-progress" class="progress-bar bg-green-500" style="width: 0%;"></div>
                         </div>
                         <div id="budget-alert" class="text-center font-bold mt-2 rounded-lg p-2 text-sm"></div>
                     </div>
                </div>

                <!-- Savings Goal Progress -->
                <div class="panel p-6">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">စုငွေပန်းတိုင်များ</h3>
                    <div id="savings-goals-container" class="space-y-4 max-h-40 overflow-y-auto">
                        <!-- ပန်းတိုင်များ ဒီမှာပေါ်လာပါမည် -->
                    </div>
                </div>

                <!-- Chart Analysis -->
                <div class="panel p-6">
                    <h3 class="text-lg font-bold text-slate-200 mb-4">သုံးစွဲမှု ဆန်းစစ်ခြင်း</h3>
                    <div class="mb-6">
                        <h4 class="text-sm font-semibold text-slate-300 mb-2 text-center">ဝင်ငွေ နှင့် ထွက်ငွေ</h4>
                        <canvas id="income-expense-chart" class="max-h-40"></canvas>
                    </div>
                    <div>
                         <h4 class="text-sm font-semibold text-slate-300 mb-2 text-center">ထွက်ငွေ အမျိုးအစားများ</h4>
                        <canvas id="expense-chart" class="max-h-52"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Transaction Modal -->
    <div id="add-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-30">
        <div class="modal-content panel p-6 w-full max-w-sm transform opacity-0 -translate-y-10">
            <h3 class="text-xl font-bold mb-4 text-slate-100">စာရင်းသစ်ထည့်ရန်</h3>
            <form id="form">
                 <div class="mb-4">
                    <label for="type" class="block font-medium text-slate-300 mb-1">အမျိုးအစား</label>
                    <select id="type" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition">
                        <option value="" disabled selected>-- အမျိုးအစား ရွေးပါ --</option>
                        <option value="expense">ထွက်ငွေ</option>
                        <option value="income">ဝင်ငွေ</option>
                        <option value="saving">စုငွေ</option>
                    </select>
                </div>
                <div id="add-form-details" class="hidden">
                    <div class="mb-4 hidden" id="saving-goal-link-container">
                        <label for="saving-goal-link" class="block font-medium text-slate-300 mb-1">စုငွေပန်းတိုင်သို့ ထည့်ရန်</label>
                        <select id="saving-goal-link" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"></select>
                    </div>
                     <div class="mb-4" id="category-container">
                        <label for="category" class="block font-medium text-slate-300 mb-1">အမျိုးအစားခွဲ</label>
                        <select id="category" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"></select>
                    </div>
                    <div class="mb-4">
                        <label for="text" class="block font-medium text-slate-300 mb-1">အကြောင်းအရာ</label>
                        <input type="text" id="text" placeholder="အကြောင်းအရာ ရိုက်ထည့်ပါ..." class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" autocomplete="off" required/>
                    </div>
                    <div class="mb-6">
                        <label for="amount" class="block font-medium text-slate-300 mb-1">ငွေပမာဏ</label>
                        <input type="text" inputmode="decimal" id="amount" placeholder="ငွေပမာဏ ရိုက်ထည့်ပါ..." class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" autocomplete="off" required/>
                    </div>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-add-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition">မထည့်တော့ပါ</button>
                    <button type="submit" class="bg-cyan-500 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-cyan-400 transition">မှတ်တမ်းတင်မည်</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-30">
        <div class="modal-content panel p-6 w-full max-w-sm transform opacity-0 -translate-y-10">
            <h3 class="text-xl font-bold mb-4 text-slate-100">စုငွေပန်းတိုင်အသစ်</h3>
            <form id="goal-form">
                <div class="mb-4">
                    <label for="goal-name" class="block font-medium text-slate-300 mb-1">ပန်းတိုင်အမည်</label>
                    <input type="text" id="goal-name" placeholder="ဥပမာ - ကားဝယ်ရန်" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" required />
                </div>
                <div class="mb-6">
                    <label for="goal-target" class="block font-medium text-slate-300 mb-1">ပန်းတိုင်ငွေပမာဏ</label>
                    <input type="text" inputmode="decimal" id="goal-target" placeholder="ဥပမာ - 500,000" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" required />
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancel-add-goal-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition">မထည့်တော့ပါ</button>
                    <button type="submit" class="bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-700 transition">ပန်းတိုင်သတ်မှတ်မည်</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-30">
        <div class="modal-content panel p-6 w-full max-w-sm transform opacity-0 -translate-y-10">
            <h3 class="text-xl font-bold mb-4 text-slate-100">စာရင်းပြင်ဆင်ရန်</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                 <div class="mb-4">
                    <label for="edit-type" class="block font-medium text-slate-300 mb-1">အမျိုးအစား</label>
                    <select id="edit-type" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition">
                        <option value="expense">ထွက်ငွေ</option>
                        <option value="income">ဝင်ငွေ</option>
                        <option value="saving">စုငွေ</option>
                    </select>
                </div>
                <div id="edit-form-details">
                    <div class="mb-4 hidden" id="edit-saving-goal-link-container">
                        <label for="edit-saving-goal-link" class="block font-medium text-slate-300 mb-1">စုငွေပန်းတိုင်သို့ ထည့်ရန်</label>
                        <select id="edit-saving-goal-link" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"></select>
                    </div>
                     <div class="mb-4" id="edit-category-container">
                        <label for="edit-category" class="block font-medium text-slate-300 mb-1">အမျိုးအစားခွဲ</label>
                        <select id="edit-category" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"></select>
                    </div>
                    <div class="mb-4">
                        <label for="edit-text" class="block font-medium text-slate-300 mb-1">အကြောင်းအရာ</label>
                        <input type="text" id="edit-text" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" required>
                    </div>
                    <div class="mb-6">
                        <label for="edit-amount" class="block font-medium text-slate-300 mb-1">ငွေပမာဏ</label>
                        <input type="text" inputmode="decimal" id="edit-amount" class="w-full px-3 py-2 border bg-slate-700 border-slate-600 text-slate-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" required>
                    </div>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-edit-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition">မပြင်တော့ပါ</button>
                    <button type="submit" class="bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-700 transition">သိမ်းဆည်းမည်</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-40">
        <div class="modal-content panel p-6 w-full max-w-sm text-center transform opacity-0 -translate-y-10">
            <h3 class="text-xl font-bold mb-4 text-slate-100">အတည်ပြုပါ</h3>
            <p class="text-slate-300 mb-6">ဤစာရင်းကို ဖျက်ရန် သေချာပါသလား?</p>
            <div class="flex justify-center gap-4">
                <button type="button" id="cancel-delete-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition">မဖျက်တော့ပါ</button>
                <button type="button" id="confirm-delete-btn" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition">အတည်ပြုသည်</button>
            </div>
        </div>
    </div>
    
    <!-- Import Confirmation Modal -->
    <div id="import-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-40">
        <div class="modal-content panel p-6 w-full max-w-sm text-center transform opacity-0 -translate-y-10">
            <h3 class="text-xl font-bold mb-4 text-slate-100">တင်သွင်းမှု အတည်ပြုပါ</h3>
            <p class="text-slate-300 mb-6">သင်၏ လက်ရှိဒေတာအားလုံးကို တင်သွင်းလိုက်သောဖိုင်ဖြင့် အစားထိုးသွားမည်ဖြစ်သည်။ ဤလုပ်ဆောင်ချက်သည် နောက်ပြန်ပြင်၍မရပါ။ ရှေ့ဆက်ရန် သေချာပါသလား?</p>
            <div class="flex justify-center gap-4">
                <button type="button" id="cancel-import-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition">မလုပ်တော့ပါ</button>
                <button type="button" id="confirm-import-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">အတည်ပြုသည်</button>
            </div>
        </div>
    </div>

    <!-- Delete All Confirmation Modal -->
    <div id="delete-all-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center p-4 hidden opacity-0 z-40">
        <div class="modal-content panel p-6 w-full max-w-md text-center transform opacity-0 -translate-y-10">
            <div id="delete-all-step-1">
                <h3 class="text-2xl font-bold mb-4 text-red-400">အချက်အလက်အားလုံးကို ဖျက်မည်</h3>
                <p class="text-slate-300 mb-4">ဤလုပ်ဆောင်ချက်သည် သင်၏ မှတ်တမ်းများ၊ ဘတ်ဂျက်များ၊ နှင့် စုငွေပန်းတိုင်များ အားလုံးကို အပြီးတိုင် ဖျက်ပစ်မည်ဖြစ်သည်။ ဤလုပ်ဆောင်ချက်ကို နောက်ပြန်ပြင်၍မရပါ။</p>
                <p class="text-slate-300 mb-4">ရှေ့ဆက်ရန်အတွက် အောက်ပါအကွက်တွင် <code class="bg-slate-900 text-amber-400 font-bold px-2 py-1 rounded">DELETE</code> ဟု ရိုက်ထည့်ပါ။</p>
                <input type="text" id="delete-all-confirm-input" class="w-full text-center px-3 py-2 border bg-slate-700 border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:ring-2 focus:ring-red-500 transition mb-6" autocomplete="off">
                <div class="flex justify-center gap-4">
                    <button type="button" id="cancel-delete-all-btn" class="bg-slate-600 text-slate-200 font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition">မလုပ်တော့ပါ</button>
                    <button type="button" id="confirm-delete-all-step1-btn" class="bg-slate-500 text-white font-bold py-2 px-6 rounded-lg transition cursor-not-allowed" disabled>အတည်ပြုသည်</button>
                </div>
            </div>
            <div id="delete-all-step-2" class="hidden">
                <h3 class="text-2xl font-bold mb-4 text-red-400">သင် သေချာပါသလား?</h3>
                <p class="text-slate-300 mb-6">ဒေတာအားလုံးကို အပြီးတိုင်ဖျက်ရန် သင်တကယ်သေချာပါသလား?</p>
                <div class="flex justify-center gap-4">
                    <button type="button" class="cancel-delete-all-generic-btn bg-slate-600 text-slate-200 font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition">မလုပ်တော့ပါ</button>
                    <button type="button" id="confirm-delete-all-step2-btn" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition">ဟုတ်ကဲ့၊ သေချာသည်</button>
                </div>
            </div>
            <div id="delete-all-step-3" class="hidden">
                 <h3 class="text-2xl font-bold mb-4 text-red-400">နောက်ဆုံး သတိပေးချက်</h3>
                <p class="text-slate-300 mb-6">ဤသည်မှာ နောက်ဆုံးသတိပေးချက် ဖြစ်သည်။ ခလုတ်ကိုနှိပ်လိုက်သည်နှင့် ဒေတာအားလုံးကို ပြန်ယူနိုင်တော့မည်မဟုတ်ပါ။</p>
                <div class="flex justify-center gap-4">
                    <button type="button" class="cancel-delete-all-generic-btn bg-slate-600 text-slate-200 font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition">မလုပ်တော့ပါ</button>
                    <button type="button" id="confirm-delete-all-final-btn" class="bg-red-800 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-900 transition animate-pulse">အရာအားလုံးကို ဖျက်ပါ</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // HTML elements များကို JavaScript တွင် အသုံးပြုရန် သတ်မှတ်ခြင်း
        const loadingOverlay = document.getElementById('loading-overlay');
        const appContent = document.getElementById('app-content');
        const card_income = document.getElementById('card-income');
        const card_expense = document.getElementById('card-expense');
        const card_savings = document.getElementById('card-savings');
        const card_balance = document.getElementById('card-balance');
        const card_budget_remaining = document.getElementById('card-budget-remaining');
        
        const list = document.getElementById('list');
        const form = document.getElementById('form');
        const addFormDetails = document.getElementById('add-form-details');
        const text = document.getElementById('text');
        const amount = document.getElementById('amount');
        const type = document.getElementById('type');
        const categoryContainer = document.getElementById('category-container');
        const category = document.getElementById('category');
        const savingGoalLinkContainer = document.getElementById('saving-goal-link-container');
        const savingGoalLink = document.getElementById('saving-goal-link');
        
        const budgetForm = document.getElementById('budget-form');
        const budgetInput = document.getElementById('budget-input');
        const budgetProgress = document.getElementById('budget-progress');
        const budgetAlert = document.getElementById('budget-alert');
        const setBudgetBtn = document.getElementById('set-budget-btn');

        const addModal = document.getElementById('add-modal');
        const openAddModalBtn = document.getElementById('open-add-modal-btn');
        const cancelAddBtn = document.getElementById('cancel-add-btn');

        const editModal = document.getElementById('edit-modal');
        const editForm = document.getElementById('edit-form');
        const editFormDetails = document.getElementById('edit-form-details');
        const editId = document.getElementById('edit-id');
        const editText = document.getElementById('edit-text');
        const editAmount = document.getElementById('edit-amount');
        const editType = document.getElementById('edit-type');
        const editCategoryContainer = document.getElementById('edit-category-container');
        const editCategory = document.getElementById('edit-category');
        const editSavingGoalLinkContainer = document.getElementById('edit-saving-goal-link-container');
        const editSavingGoalLink = document.getElementById('edit-saving-goal-link');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        
        const deleteModal = document.getElementById('delete-modal');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        let transactionToDeleteId = null;

        const addGoalModal = document.getElementById('add-goal-modal');
        const openAddGoalBtn = document.getElementById('open-add-goal-btn');
        const cancelAddGoalBtn = document.getElementById('cancel-add-goal-btn');
        const goalForm = document.getElementById('goal-form');
        const goalName = document.getElementById('goal-name');
        const goalTarget = document.getElementById('goal-target');
        const savingsGoalsContainer = document.getElementById('savings-goals-container');
        
        const menuBtn = document.getElementById('menu-btn');
        const menuDropdown = document.getElementById('menu-dropdown');
        const exportDataBtn = document.getElementById('export-data-btn');
        const importDataBtn = document.getElementById('import-data-btn');
        const importFileInput = document.getElementById('import-file-input');
        const importModal = document.getElementById('import-modal');
        const cancelImportBtn = document.getElementById('cancel-import-btn');
        const confirmImportBtn = document.getElementById('confirm-import-btn');

        const deleteAllBtn = document.getElementById('delete-all-btn');
        const deleteAllModal = document.getElementById('delete-all-modal');
        const deleteAllStep1 = document.getElementById('delete-all-step-1');
        const deleteAllStep2 = document.getElementById('delete-all-step-2');
        const deleteAllStep3 = document.getElementById('delete-all-step-3');
        const cancelDeleteAllBtn = document.getElementById('cancel-delete-all-btn');
        const cancelDeleteAllGenericBtns = document.querySelectorAll('.cancel-delete-all-generic-btn');
        const deleteAllConfirmInput = document.getElementById('delete-all-confirm-input');
        const confirmDeleteAllStep1Btn = document.getElementById('confirm-delete-all-step1-btn');
        const confirmDeleteAllStep2Btn = document.getElementById('confirm-delete-all-step2-btn');
        const confirmDeleteAllFinalBtn = document.getElementById('confirm-delete-all-final-btn');
        
        const yearFilter = document.getElementById('year-filter');
        const monthFilter = document.getElementById('month-filter');
        const transactionFilterButtons = document.getElementById('transaction-filter-buttons');

        const expenseChartCtx = document.getElementById('expense-chart').getContext('2d');
        const incomeExpenseChartCtx = document.getElementById('income-expense-chart').getContext('2d');
        let expenseChartInstance;
        let incomeExpenseChartInstance;
        
        // App State (အချက်အလက်များ သိမ်းဆည်းရန် variables)
        let allTransactions = [];
        let budget = 0;
        let savingGoals = [];
        let dataToImport = null;
        let currentTransactionFilter = 'all';

        const categories = {
          income: ['လစာ', 'ဆုကြေး', 'ရင်းနှီးမြှုပ်နှံမှု', 'အပိုဝင်ငွေ', 'လက်ဆောင်', 'အခြား'],
          expense: ['အစားအသောက်', 'သယ်ယူပို့ဆောင်ရေး', 'အိမ်သုံးစရိတ်', 'ဖုန်းဘေလ်/အင်တာနက်', 'ကိုယ်ပိုင်သုံး', 'ဖျော်ဖြေရေး', 'ကျန်းမာရေး', 'ပညာရေး', 'အဝတ်အထည်', 'အလှူအတန်း', 'အခြား'],
        };
        
        // --- Data Persistence (LocalStorage) ---
        const LOCAL_STORAGE_KEY = 'budgetTrackerData-v1';

        function saveDataToLocalStorage() {
            const data = {
                transactions: allTransactions,
                budget: budget,
                savingGoals: savingGoals
            };
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        }

        function loadDataFromLocalStorage() {
            const dataJSON = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (dataJSON) {
                const data = JSON.parse(dataJSON);
                allTransactions = (data.transactions || []).map(t => ({...t, date: t.date || new Date(t.id).toISOString()}));
                budget = data.budget || 0;
                savingGoals = data.savingGoals || [];
            } else {
                // Default initial state if nothing in storage
                allTransactions = [];
                budget = 0;
                savingGoals = [];
            }
        }
        
        // အထွေထွေ Functions
        function formatNumber(number) { return new Intl.NumberFormat('en-US').format(number); }
        function generateID() { return Date.now(); }
        function getNumericValue(valueString) {
            if (typeof valueString !== 'string') return 0;
            return parseFloat(valueString.replace(/,/g, '')) || 0;
        }

        function formatInputAsCurrency(event) {
            const input = event.target;
            let value = input.value.replace(/[^0-9.]/g, '');
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            const [integerPart, decimalPart] = value.split('.');
            const formattedInteger = integerPart ? new Intl.NumberFormat('en-US').format(integerPart) : '';
            input.value = decimalPart !== undefined ? `${formattedInteger}.${decimalPart}` : formattedInteger;
        }

        // Data Management Functions (Export/Import)
        function exportData() {
            const dataToExport = { budget: budget, savingGoals: savingGoals, transactions: allTransactions };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `personal_finance_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if ('transactions' in importedData && 'budget' in importedData && 'savingGoals' in importedData) {
                        dataToImport = importedData;
                        openModal(importModal);
                    } else {
                        alert('JSON ဖိုင်၏ ပုံစံ မှားယွင်းနေပါသည်။');
                    }
                } catch (error) {
                    console.error("Error parsing JSON file:", error);
                    alert('JSON ဖိုင်ကို ဖတ်ရှုရာတွင် အမှားအယွင်း ဖြစ်ပေါ်ပါသည်။');
                }
            };
            reader.readAsText(file);
            event.target.value = null;
        }
        
        function confirmImport() {
            if (dataToImport) {
                budget = dataToImport.budget;
                savingGoals = dataToImport.savingGoals;
                allTransactions = dataToImport.transactions;
                saveDataToLocalStorage();
                updateDisplay();
                dataToImport = null;
                closeModal(importModal);
            }
        }

        // စုငွေပန်းတိုင် Functions
        function renderSavingGoals() {
            savingsGoalsContainer.innerHTML = '';
            if (savingGoals.length === 0) {
                savingsGoalsContainer.innerHTML = `<p class="text-center text-slate-400 text-sm">စုငွေပန်းတိုင် မရှိသေးပါ။</p>`;
                return;
            }
            savingGoals.forEach(goal => {
                const savedAmount = allTransactions.filter(t => t.type === 'saving' && t.goalId === goal.id).reduce((acc, t) => acc + Math.abs(t.amount), 0);
                const progressPercentage = goal.target > 0 ? Math.min((savedAmount / goal.target) * 100, 100) : 0;
                const goalEl = document.createElement('div');
                goalEl.classList.add('bg-slate-700/50', 'p-3', 'rounded-lg');
                goalEl.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-200 text-sm">${goal.name}</span>
                        <span class="text-xs ${progressPercentage === 100 ? 'bg-green-500/20 text-green-300' : 'bg-blue-500/20 text-blue-300'} px-2 py-1 rounded-full">${progressPercentage === 100 ? 'ပြီးမြောက်' : 'လုပ်ဆောင်ဆဲ'}</span>
                    </div>
                    <div class="progress-bar-container mb-1">
                        <div class="progress-bar bg-blue-500" style="width: ${progressPercentage}%;"></div>
                    </div>
                    <div class="flex justify-between text-xs text-slate-400">
                        <span>${formatNumber(savedAmount)} / ${formatNumber(goal.target)} ကျပ်</span>
                        <span>${progressPercentage.toFixed(0)}%</span>
                    </div>`;
                savingsGoalsContainer.appendChild(goalEl);
            });
        }

        function handleAddGoalSubmit(e) {
            e.preventDefault();
            if (goalName.value.trim() === '' || goalTarget.value.trim() === '') return;
            const newGoal = { id: generateID(), name: goalName.value, target: getNumericValue(goalTarget.value) };
            savingGoals.push(newGoal);
            saveDataToLocalStorage();
            updateDisplay();
            closeAddGoalModal();
        }
        
        function populateGoalOptions(selectElement) {
            selectElement.innerHTML = `<option value="none">-- ပန်းတိုင် မချိတ်ဆက်ပါ --</option>`;
            savingGoals.forEach(goal => {
                const option = document.createElement('option');
                option.value = goal.id;
                option.innerText = goal.name;
                selectElement.appendChild(option);
            });
        }
        
        function toggleGoalSelector(transactionType, containerElement, selectElement) {
            if (transactionType === 'saving' && savingGoals.length > 0) {
                populateGoalOptions(selectElement);
                containerElement.classList.remove('hidden');
            } else {
                containerElement.classList.add('hidden');
            }
        }

        // ငွေဝင်ငွေထွက် Functions
        function updateCategoryOptions(transactionType, categoryElement, containerElement) {
            const currentCategories = categories[transactionType];
            categoryElement.innerHTML = '';
            if (currentCategories && currentCategories.length > 0) {
                containerElement.style.display = 'block';
                currentCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat; option.innerText = cat;
                    categoryElement.appendChild(option);
                });
            } else {
                containerElement.style.display = 'none';
            }
        }

        function addTransaction(e) {
            e.preventDefault();
            if (type.value === '' || text.value.trim() === '' || amount.value.trim() === '') return;
            const numericAmount = getNumericValue(amount.value);
            let transactionAmount = type.value === 'expense' || type.value === 'saving' ? -numericAmount : numericAmount;
            const newTransaction = { 
                id: generateID(), date: new Date().toISOString(), text: text.value, 
                amount: transactionAmount, type: type.value, category: category.value,
                goalId: type.value === 'saving' && savingGoalLink.value !== 'none' ? parseInt(savingGoalLink.value) : null,
            };
            allTransactions.push(newTransaction);
            saveDataToLocalStorage();
            updateDisplay();
            closeAddModal();
        }

        function addTransactionDOM(transaction) {
            const sign = transaction.amount < 0 ? '-' : '+';
            const item = document.createElement('li');
            const transactionType = transaction.type;
            let itemClass, displayAmountColorClass;
            switch(transactionType) {
                case 'income': itemClass = 'plus'; displayAmountColorClass = 'text-green-400'; break;
                case 'expense': itemClass = 'minus'; displayAmountColorClass = 'text-red-400'; break;
                case 'saving': itemClass = 'saving'; displayAmountColorClass = 'text-blue-400'; break;
                default: itemClass = 'plus'; displayAmountColorClass = 'text-slate-200';
            }
            item.classList.add('transaction-item', itemClass, 'bg-slate-700/50', 'p-3', 'rounded-lg', 'flex', 'justify-between', 'items-center', 'relative', 'group', 'transition-colors', 'hover:bg-slate-700');
            const categoryHTML = transaction.category && transaction.type !== 'saving' ? `<span class="text-xs text-slate-400 block">${transaction.category}</span>` : '';
            const dateHTML = `<span class="text-xs text-slate-500 block">${new Date(transaction.date).toLocaleDateString('en-CA')}</span>`;
            item.innerHTML = `
                <div>
                    <span class="text-slate-100 font-medium">${transaction.text}</span> ${categoryHTML} ${dateHTML}
                </div>
                <div class="flex items-center">
                    <span class="font-semibold ${displayAmountColorClass}">${sign}${formatNumber(Math.abs(transaction.amount))} ကျပ်</span>
                    <div class="actions ml-3 opacity-0 group-hover:opacity-100 transition-opacity flex items-center">
                        <button onclick="window.openEditModal(${transaction.id})" class="p-1 text-slate-400 hover:text-cyan-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                        <button onclick="window.openDeleteModal(${transaction.id})" class="p-1 text-slate-400 hover:text-red-500 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>
                    </div>
                </div>`;
            list.appendChild(item);
        }
        
        // UI ကို Update လုပ်ခြင်း
        function updateBudgetDisplay(totalExpense) {
            if (budget <= 0) {
                card_budget_remaining.innerText = 'N/A';
                budgetAlert.innerHTML = 'ဘတ်ဂျက် သတ်မှတ်ရန် လိုအပ်ပါသည်။';
                budgetAlert.className = 'text-center font-bold mt-2 rounded-lg p-2 text-sm text-slate-400';
                budgetProgress.style.width = '0%';
                return;
            }
            const remaining = budget - totalExpense;
            const spentPercentage = budget > 0 ? (totalExpense / budget) * 100 : 0;
            card_budget_remaining.innerText = `${formatNumber(remaining.toFixed(2))} ကျပ်`;
            budgetProgress.style.width = `${Math.min(spentPercentage, 100)}%`;
            budgetAlert.innerHTML = ''; budgetAlert.className = 'text-center font-bold mt-2 rounded-lg p-2 text-sm';
            if (spentPercentage > 100) {
                budgetProgress.style.backgroundColor = '#ef4444'; budgetAlert.innerText = '🔥 ဘတ်ဂျက် ကျော်လွန်သုံးစွဲနေပါသည်!';
                budgetAlert.classList.add('bg-red-500/20', 'text-red-300'); card_budget_remaining.classList.add('text-red-400');
            } else if (spentPercentage >= 90) {
                budgetProgress.style.backgroundColor = '#f59e0b'; budgetAlert.innerText = '⚠️ ဘတ်ဂျက် ပြည့်တော့မည်!';
                budgetAlert.classList.add('bg-amber-500/20', 'text-amber-300'); card_budget_remaining.classList.remove('text-red-400');
            } else {
                budgetProgress.style.backgroundColor = '#22c55e'; card_budget_remaining.classList.remove('text-red-400');
            }
        }
        
        function renderCharts(income, expense, displayTransactions) {
            const expenseByCategory = displayTransactions.filter(t => t.type === 'expense').reduce((acc, transaction) => {
                    const category = transaction.category || 'အခြား';
                    if (!acc[category]) { acc[category] = 0; }
                    acc[category] += Math.abs(transaction.amount);
                    return acc;
                }, {});
            if (expenseChartInstance) expenseChartInstance.destroy();
            expenseChartInstance = new Chart(expenseChartCtx, {
                type: 'doughnut', data: { labels: Object.keys(expenseByCategory), datasets: [{ data: Object.values(expenseByCategory), backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6', '#22c55e', '#14b8a6', '#f97316', '#64748b'], hoverOffset: 4, borderColor: '#1e293b' }] },
                options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#cbd5e1', boxWidth: 12, padding: 15 } } } }
            });
            if (incomeExpenseChartInstance) incomeExpenseChartInstance.destroy();
            incomeExpenseChartInstance = new Chart(incomeExpenseChartCtx, {
                type: 'bar', data: { labels: ['ဝင်ငွေ', 'ထွက်ငွေ'], datasets: [{ data: [income, Math.abs(expense)], backgroundColor: ['rgba(34, 197, 94, 0.6)', 'rgba(239, 68, 68, 0.6)'], borderColor: ['#22c55e', '#ef4444'], borderWidth: 1 }] },
                options: { scales: { y: { beginAtZero: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }, x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } } }, responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function updateValues(displayTransactions) {
            const total = displayTransactions.reduce((acc, item) => (acc += item.amount), 0);
            const income = displayTransactions.filter(t => t.type === 'income').reduce((acc, item) => (acc += item.amount), 0);
            const expense = displayTransactions.filter(t => t.type === 'expense').reduce((acc, item) => (acc += item.amount), 0);
            const savings = displayTransactions.filter(t => t.type === 'saving').reduce((acc, item) => (acc += item.amount), 0);
            card_balance.innerText = `${formatNumber(total.toFixed(2))} ကျပ်`;
            card_income.innerText = `+${formatNumber(income.toFixed(2))} ကျပ်`;
            card_expense.innerText = `-${formatNumber(Math.abs(expense).toFixed(2))} ကျပ်`;
            card_savings.innerText = `${formatNumber(Math.abs(savings).toFixed(2))} ကျပ်`;
            updateBudgetDisplay(Math.abs(expense));
            renderCharts(income, expense, displayTransactions);
        }

        function removeTransaction(id) { 
            allTransactions = allTransactions.filter(transaction => transaction.id !== id);
            saveDataToLocalStorage();
            updateDisplay();
        }
        function setBudget(e) { 
            e.preventDefault(); 
            const newBudget = getNumericValue(budgetInput.value); 
            if (!isNaN(newBudget) && newBudget >= 0) { 
                budget = newBudget;
                saveDataToLocalStorage();
                updateDisplay();
            } 
            budgetInput.value = ''; 
            budgetForm.classList.add('hidden'); 
        }
        
        // Modal Functions
        function openModal(modalElement) {
            modalElement.classList.remove('hidden');
            setTimeout(() => {
                modalElement.classList.remove('opacity-0');
                modalElement.querySelector('.modal-content').classList.remove('opacity-0', '-translate-y-10');
            }, 10);
        }
        function closeModal(modalElement) {
            modalElement.classList.add('opacity-0');
            modalElement.querySelector('.modal-content').classList.add('opacity-0', '-translate-y-10');
            setTimeout(() => { modalElement.classList.add('hidden'); }, 300);
        }
        const openAddModal = () => { form.reset(); addFormDetails.classList.add('hidden'); openModal(addModal); };
        const closeAddModal = () => closeModal(addModal);
        const openAddGoalModal = () => openModal(addGoalModal);
        const closeAddGoalModal = () => { closeModal(addGoalModal); goalForm.reset(); };
        const closeEditModal = () => closeModal(editModal);
        const closeDeleteModal = () => { closeModal(deleteModal); transactionToDeleteId = null; };
        const closeImportModal = () => { closeModal(importModal); dataToImport = null; }
        
        window.openEditModal = (id) => {
            const transaction = allTransactions.find(t => t.id === id);
            if (!transaction) return;
            editId.value = id; editType.value = transaction.type;
            editFormDetails.classList.remove('hidden');
            updateCategoryOptions(transaction.type, editCategory, editCategoryContainer);
            editCategory.value = transaction.category;
            toggleGoalSelector(transaction.type, editSavingGoalLinkContainer, editSavingGoalLink);
            editSavingGoalLink.value = transaction.goalId || 'none';
            editText.value = transaction.text;
            editAmount.value = formatNumber(Math.abs(transaction.amount));
            openModal(editModal);
        }

        function handleEditSubmit(e) {
            e.preventDefault();
            const id = parseInt(editId.value);
            allTransactions = allTransactions.map(t => {
                if (t.id === id) {
                    const updatedType = editType.value;
                    const updatedAmount = getNumericValue(editAmount.value);
                    let finalAmount = updatedType === 'expense' || updatedType === 'saving' ? -Math.abs(updatedAmount) : +Math.abs(updatedAmount);
                    return { ...t, text: editText.value, amount: finalAmount, type: updatedType, category: editCategory.value, goalId: updatedType === 'saving' && editSavingGoalLink.value !== 'none' ? parseInt(editSavingGoalLink.value) : null };
                }
                return t;
            });
            saveDataToLocalStorage();
            updateDisplay();
            closeEditModal();
        }

        window.openDeleteModal = (id) => { transactionToDeleteId = id; openModal(deleteModal); }
        function confirmDelete() { if(transactionToDeleteId !== null) { removeTransaction(transactionToDeleteId); } closeDeleteModal(); }
        
        // Delete All Data Functions
        function openDeleteAllModal() {
            deleteAllStep1.classList.remove('hidden'); deleteAllStep2.classList.add('hidden'); deleteAllStep3.classList.add('hidden');
            deleteAllConfirmInput.value = ''; confirmDeleteAllStep1Btn.disabled = true;
            confirmDeleteAllStep1Btn.classList.add('bg-slate-500', 'cursor-not-allowed');
            confirmDeleteAllStep1Btn.classList.remove('bg-red-600', 'hover:bg-red-700');
            openModal(deleteAllModal);
        }
        const closeDeleteAllModal = () => closeModal(deleteAllModal);
        function handleConfirmInput(e) {
            if (e.target.value === 'DELETE') {
                confirmDeleteAllStep1Btn.disabled = false;
                confirmDeleteAllStep1Btn.classList.remove('bg-slate-500', 'cursor-not-allowed');
                confirmDeleteAllStep1Btn.classList.add('bg-red-600', 'hover:bg-red-700');
            } else {
                confirmDeleteAllStep1Btn.disabled = true;
                confirmDeleteAllStep1Btn.classList.add('bg-slate-500', 'cursor-not-allowed');
                confirmDeleteAllStep1Btn.classList.remove('bg-red-600', 'hover:bg-red-700');
            }
        }
        function showDeleteAllStep2() { deleteAllStep1.classList.add('hidden'); deleteAllStep2.classList.remove('hidden'); }
        function showDeleteAllStep3() { deleteAllStep2.classList.add('hidden'); deleteAllStep3.classList.remove('hidden'); }
        function deleteAllData() {
            allTransactions = [];
            budget = 0;
            savingGoals = [];
            saveDataToLocalStorage();
            updateDisplay();
            closeDeleteAllModal();
        }

        // Filter and Render Functions
        function populateFilters() {
            const years = [...new Set(allTransactions.map(t => new Date(t.date).getFullYear()))]; years.sort((a,b) => b - a);
            const currentYearVal = yearFilter.value;
            yearFilter.innerHTML = '<option value="all">All Time</option>';
            years.forEach(year => { const option = document.createElement('option'); option.value = year; option.textContent = year; yearFilter.appendChild(option); });
            if (years.includes(parseInt(currentYearVal))) { yearFilter.value = currentYearVal; }
            const currentMonthVal = monthFilter.value;
            monthFilter.innerHTML = `<option value="all">လအားလုံး</option>`;
            const burmeseMonths = ["ဇန်နဝါရီ", "ဖေဖော်ဝါရီ", "မတ်", "ဧပြီ", "မေ", "ဇွန်", "ဇူလိုင်", "ဩဂုတ်", "စက်တင်ဘာ", "အောက်တိုဘာ", "နိုဝင်ဘာ", "ဒီဇင်ဘာ"];
            burmeseMonths.forEach((month, index) => { const option = document.createElement('option'); option.value = index; option.textContent = month; monthFilter.appendChild(option); });
            monthFilter.value = currentMonthVal;
        }

        function updateDisplay() {
            const selectedYear = yearFilter.value; const selectedMonth = monthFilter.value;
            let transactionsToDisplay = allTransactions;
            if (selectedYear !== 'all') {
                transactionsToDisplay = transactionsToDisplay.filter(t => new Date(t.date).getFullYear() == selectedYear);
                if (selectedMonth !== 'all') { transactionsToDisplay = transactionsToDisplay.filter(t => new Date(t.date).getMonth() == selectedMonth); }
            }
            monthFilter.disabled = (selectedYear === 'all');
            if (selectedYear === 'all') { monthFilter.value = 'all'; }
            renderUI(transactionsToDisplay);
        }

        function renderUI(displayTransactions) {
            list.innerHTML = '';
            let filteredByType = displayTransactions;
            if (currentTransactionFilter !== 'all') { filteredByType = displayTransactions.filter(t => t.type === currentTransactionFilter); }
            if (filteredByType.length === 0) {
                 list.innerHTML = `<li class="text-center text-slate-400 p-4">မှတ်တမ်းများ မရှိသေးပါ။</li>`;
            } else {
                filteredByType.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(addTransactionDOM);
            }
            updateValues(displayTransactions);
            renderSavingGoals();
        }
        
        // App Initializer
        function initializeApp() {
            loadDataFromLocalStorage();
            populateFilters();
            updateDisplay();
            
            // Hide loader, show app
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => loadingOverlay.classList.add('hidden'), 300);
            appContent.classList.remove('opacity-0');
        }

        // Event Listeners
        form.addEventListener('submit', addTransaction);
        goalForm.addEventListener('submit', handleAddGoalSubmit);
        budgetForm.addEventListener('submit', setBudget);
        setBudgetBtn.addEventListener('click', () => { budgetForm.classList.toggle('hidden'); if (!budgetForm.classList.contains('hidden')) { budgetInput.focus(); } });
        editForm.addEventListener('submit', handleEditSubmit);
        cancelEditBtn.addEventListener('click', closeEditModal);
        cancelDeleteBtn.addEventListener('click', closeDeleteModal);
        confirmDeleteBtn.addEventListener('click', confirmDelete);
        openAddModalBtn.addEventListener('click', openAddModal);
        cancelAddBtn.addEventListener('click', closeAddModal);
        openAddGoalBtn.addEventListener('click', openAddGoalModal);
        cancelAddGoalBtn.addEventListener('click', closeAddGoalModal);
        exportDataBtn.addEventListener('click', exportData);
        importDataBtn.addEventListener('click', () => importFileInput.click());
        importFileInput.addEventListener('change', handleFileImport);
        confirmImportBtn.addEventListener('click', confirmImport);
        cancelImportBtn.addEventListener('click', closeImportModal);
        deleteAllBtn.addEventListener('click', openDeleteAllModal);
        cancelDeleteAllBtn.addEventListener('click', closeDeleteAllModal);
        cancelDeleteAllGenericBtns.forEach(btn => btn.addEventListener('click', closeDeleteAllModal));
        deleteAllConfirmInput.addEventListener('input', handleConfirmInput);
        confirmDeleteAllStep1Btn.addEventListener('click', showDeleteAllStep2);
        confirmDeleteAllStep2Btn.addEventListener('click', showDeleteAllStep3);
        confirmDeleteAllFinalBtn.addEventListener('click', deleteAllData);
        menuBtn.addEventListener('click', (event) => { event.stopPropagation(); menuDropdown.classList.toggle('hidden'); });
        window.addEventListener('click', (event) => { if (!menuDropdown.classList.contains('hidden') && !menuBtn.contains(event.target)) { menuDropdown.classList.add('hidden'); } });
        type.addEventListener('change', (e) => {
            const selectedType = e.target.value;
            if (selectedType) {
                addFormDetails.classList.remove('hidden'); updateCategoryOptions(selectedType, category, categoryContainer); toggleGoalSelector(selectedType, savingGoalLinkContainer, savingGoalLink);
            } else { addFormDetails.classList.add('hidden'); }
        });
        editType.addEventListener('change', (e) => { updateCategoryOptions(e.target.value, editCategory, editCategoryContainer); toggleGoalSelector(e.target.value, editSavingGoalLinkContainer, editSavingGoalLink); });
        [amount, editAmount, goalTarget, budgetInput].forEach(input => { input.addEventListener('input', formatInputAsCurrency); });
        yearFilter.addEventListener('change', updateDisplay);
        monthFilter.addEventListener('change', updateDisplay);
        transactionFilterButtons.addEventListener('click', (e) => {
            const button = e.target.closest('.transaction-filter-btn');
            if (button) {
                currentTransactionFilter = button.dataset.filter;
                document.querySelectorAll('.transaction-filter-btn').forEach(btn => {
                    btn.classList.remove('bg-cyan-600', 'text-white');
                    btn.classList.add('text-slate-400', 'hover:bg-slate-700', 'hover:text-slate-200');
                });
                button.classList.add('bg-cyan-600', 'text-white');
                button.classList.remove('text-slate-400', 'hover:bg-slate-700', 'hover:text-slate-200');
                updateDisplay();
            }
        });
        
        initializeApp();
    </script>
</body>
</html>

